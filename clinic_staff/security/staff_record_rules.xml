<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Record Rules for Branch Isolation in Staff Module -->

    <!-- Staff Branch Rule - Users can only see staff from their branches -->
    <record id="staff_branch_rule" model="ir.rule">
        <field name="name">Staff: Branch Access</field>
        <field name="model_id" ref="model_clinic_staff"/>
        <field name="domain_force">['|',
            ('branch_ids', '=', False),
            ('branch_ids', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('group_clinic_staff_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Staff Manager Rule - Managers can manage staff in their branches -->
    <record id="staff_manager_rule" model="ir.rule">
        <field name="name">Staff: Manager Branch Access</field>
        <field name="model_id" ref="model_clinic_staff"/>
        <field name="domain_force">['|',
            ('branch_ids', '=', False),
            ('branch_ids', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('group_clinic_staff_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Staff Admin Rule - Admins can see all staff -->
    <record id="staff_admin_rule" model="ir.rule">
        <field name="name">Staff: Admin All Access</field>
        <field name="model_id" ref="model_clinic_staff"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_clinic_staff_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Room Branch Rule - Users can only see rooms from their branches -->
    <record id="room_branch_rule" model="ir.rule">
        <field name="name">Room: Branch Access</field>
        <field name="model_id" ref="model_clinic_room"/>
        <field name="domain_force">['|',
            ('branch_id', '=', False),
            ('branch_id', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Room Manager Rule -->
    <record id="room_manager_rule" model="ir.rule">
        <field name="name">Room: Manager Branch Access</field>
        <field name="model_id" ref="model_clinic_room"/>
        <field name="domain_force">['|',
            ('branch_id', '=', False),
            ('branch_id', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('group_clinic_staff_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>

    <!-- Staff Schedule Branch Rule -->
    <record id="staff_schedule_branch_rule" model="ir.rule">
        <field name="name">Staff Schedule: Branch Access</field>
        <field name="model_id" ref="model_clinic_staff_schedule"/>
        <field name="domain_force">['|',
            ('branch_id', '=', False),
            ('branch_id', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('group_clinic_staff_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Room Equipment Branch Rule -->
    <record id="room_equipment_branch_rule" model="ir.rule">
        <field name="name">Room Equipment: Branch Access</field>
        <field name="model_id" ref="model_clinic_room_equipment"/>
        <field name="domain_force">['|',
            ('branch_id', '=', False),
            ('branch_id', 'in', [b.id for b in user.staff_id.branch_ids] if user.staff_id else [])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Staff Own Records Rule - Staff can see/edit their own records -->
    <record id="staff_own_record_rule" model="ir.rule">
        <field name="name">Staff: Own Record Access</field>
        <field name="model_id" ref="model_clinic_staff"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
</odoo>